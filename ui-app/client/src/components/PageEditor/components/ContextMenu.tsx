import React, { useState, useEffect, useCallback } from 'react';
import { PageStoreExtractor, addListener } from '../../../context/StoreContext';
import Portal from '../../Portal';
import { PageOperations } from '../functions/PageOperations';
import Components from '../..';
import { ComponentDefinition } from '../../../types/common';
import { IconHelper } from '../../util/IconHelper';

export interface ContextMenuDetails {
	componentKey: string;
	menuPosition: { x: number; y: number };
}

interface ContextMenuProps {
	menuDetails: ContextMenuDetails | undefined;
	personalizationPath: string | undefined;
	pageExtractor: PageStoreExtractor;
	onCloseContextmenu: () => void;
	pageOperations: PageOperations;
	formStorageUrl: string | undefined;
	setClickedComponent: (pref: any) => void;
	setShowSchemaFormEditor: (key: string) => void;
}

export function ContextMenu({
	menuDetails,
	personalizationPath,
	pageExtractor,
	onCloseContextmenu,
	pageOperations,
	formStorageUrl,
	setClickedComponent,
	setShowSchemaFormEditor,
}: ContextMenuProps) {
	const [theme, setTheme] = useState('_light');

	useEffect(() => {
		if (!personalizationPath) return;
		return addListener(
			(_, v) => setTheme(v ?? '_light'),
			pageExtractor,
			`${personalizationPath}.theme`,
		);
	}, [personalizationPath]);

	if (!menuDetails) return <></>;

	let left: number | string = menuDetails.menuPosition.x;
	let top: number | string = menuDetails.menuPosition.y;

	let right: number | string = 'auto';
	let bottom: number | string = 'auto';

	if (window.innerHeight - top < 200) {
		bottom = window.innerHeight - top;
		top = 'auto';
	}

	if (window.innerWidth - left < 200) {
		right = window.innerWidth - left;
		left = 'auto';
	}

	const [componentDefinition, ifRoot] = pageOperations.getComponentDefinitionAndIfRoot(
		menuDetails.componentKey,
	);

	const intermediateDefinition = componentDefinition.properties?._intermediateDefinition?.value;

	const cdDef = Components.get(componentDefinition?.type ?? '');
	const deleteForContainer =
		componentDefinition?.type && cdDef?.allowedChildrenType?.get('') === -1 ? (
			<>
				{!ifRoot && (
					<div
						className="_popupMenuItem"
						title="Delete "
						onClick={() =>
							pageOperations.moveChildrenUpAndDelete(menuDetails.componentKey)
						}
					>
						<IconHelper viewBox="0 0 15 16">
							<path
								d="M5.7087 1.6125L5.07254 2.5H9.92745L9.29129 1.6125C9.24107 1.54375 9.15736 1.5 9.06696 1.5H5.92969C5.83929 1.5 5.75558 1.54062 5.70536 1.6125H5.7087ZM10.6306 0.78125L11.8594 2.5H12.3214H13.9286H14.1964C14.6417 2.5 15 2.83437 15 3.25C15 3.66563 14.6417 4 14.1964 4H13.9286V13.5C13.9286 14.8813 12.7299 16 11.25 16H3.75C2.27009 16 1.07143 14.8813 1.07143 13.5V4H0.803571C0.358259 4 0 3.66563 0 3.25C0 2.83437 0.358259 2.5 0.803571 2.5H1.07143H2.67857H3.14062L4.36942 0.778125C4.71763 0.29375 5.30357 0 5.92969 0H9.06696C9.69308 0 10.279 0.29375 10.6272 0.778125L10.6306 0.78125ZM2.67857 4V13.5C2.67857 14.0531 3.15737 14.5 3.75 14.5H11.25C11.8426 14.5 12.3214 14.0531 12.3214 13.5V4H2.67857Z"
								fill="currentColor"
							/>
							<path
								d="M9.79624 9.04748C9.65562 9.18793 9.465 9.26681 9.26625 9.26681C9.0675 9.26681 8.87688 9.18793 8.73625 9.04748L8.24876 8.55998V11.25C8.24876 11.4489 8.16974 11.6396 8.02909 11.7803C7.88844 11.9209 7.69768 11.9999 7.49877 11.9999C7.29986 11.9999 7.10909 11.9209 6.96844 11.7803C6.82779 11.6396 6.74877 11.4489 6.74877 11.25V8.55998L6.26128 9.04748C6.11911 9.17996 5.93106 9.25208 5.73676 9.24865C5.54246 9.24522 5.35708 9.16651 5.21967 9.0291C5.08226 8.89169 5.00355 8.7063 5.00012 8.512C4.99669 8.31771 5.06881 8.12966 5.20129 7.98749L6.96877 6.21875C7.00325 6.18355 7.04138 6.15212 7.08252 6.12501C7.09752 6.11501 7.11252 6.10751 7.12752 6.09876L7.15377 6.08501C7.17259 6.07394 7.19223 6.06433 7.21252 6.05626C7.23196 6.04834 7.25203 6.04207 7.27252 6.03751L7.30252 6.02876C7.31823 6.02245 7.33457 6.01784 7.35127 6.01501C7.44816 5.995 7.54812 5.995 7.64502 6.01501C7.66246 6.0181 7.67961 6.0227 7.69626 6.02876L7.72501 6.03751C7.7456 6.04228 7.76568 6.04898 7.78501 6.05751C7.8053 6.06558 7.82494 6.07519 7.84376 6.08626L7.87376 6.10126C7.88928 6.10863 7.90431 6.11698 7.91876 6.12626C7.96016 6.15302 7.99833 6.18448 8.03251 6.22L9.79624 7.98749C9.93669 8.12811 10.0156 8.31873 10.0156 8.51748C10.0156 8.71623 9.93669 8.90685 9.79624 9.04748Z"
								fill="currentColor"
								stroke="white"
								strokeWidth="0.3"
							/>
						</IconHelper>
						Delete and Move Children Up
					</div>
				)}
				<div
					className="_popupMenuItem"
					title="Delete"
					onClick={() =>
						pageOperations.deleteChildrenOnlyAndSetStore(menuDetails.componentKey)
					}
				>
					<IconHelper viewBox="0 0 15 16">
						<path
							d="M5.7087 1.6125L5.07254 2.5H9.92745L9.29129 1.6125C9.24107 1.54375 9.15737 1.5 9.06696 1.5H5.92969C5.83929 1.5 5.75558 1.54062 5.70536 1.6125H5.7087ZM10.6306 0.78125L11.8594 2.5H12.3214H13.9286H14.1964C14.6417 2.5 15 2.83437 15 3.25C15 3.66563 14.6417 4 14.1964 4H13.9286V13.5C13.9286 14.8813 12.7299 16 11.25 16H3.75C2.27009 16 1.07143 14.8813 1.07143 13.5V4H0.803571C0.358259 4 0 3.66563 0 3.25C0 2.83437 0.358259 2.5 0.803571 2.5H1.07143H2.67857H3.14062L4.36942 0.778125C4.71763 0.29375 5.30357 0 5.92969 0H9.06696C9.69308 0 10.279 0.29375 10.6272 0.778125L10.6306 0.78125ZM2.67857 4V13.5C2.67857 14.0531 3.15737 14.5 3.75 14.5H11.25C11.8426 14.5 12.3214 14.0531 12.3214 13.5V4H2.67857ZM5.35714 6V12.5C5.35714 12.775 5.11607 13 4.82143 13C4.52679 13 4.28571 12.775 4.28571 12.5V6C4.28571 5.725 4.52679 5.5 4.82143 5.5C5.11607 5.5 5.35714 5.725 5.35714 6ZM8.03571 6V12.5C8.03571 12.775 7.79464 13 7.5 13C7.20536 13 6.96429 12.775 6.96429 12.5V6C6.96429 5.725 7.20536 5.5 7.5 5.5C7.79464 5.5 8.03571 5.725 8.03571 6ZM10.7143 6V12.5C10.7143 12.775 10.4732 13 10.1786 13C9.88393 13 9.64286 12.775 9.64286 12.5V6C9.64286 5.725 9.88393 5.5 10.1786 5.5C10.4732 5.5 10.7143 5.725 10.7143 6Z"
							fill="currentColor"
						/>
					</IconHelper>
					Delete Children Only
				</div>
			</>
		) : (
			<></>
		);

	const showInDesignModeToggle =
		componentDefinition?.type && cdDef?.needShowInDesginMode ? (
			<>
				<div className="_popupMenuSeperator" />
				<div
					className="_popupMenuItem"
					title="Show/Hide in desgin mode"
					onClick={() => pageOperations.toggleInDesignMode(menuDetails.componentKey)}
				>
					<i className="fa fa-solid fa-toggle-on" />
					Toggle in Design mode
				</div>
			</>
		) : (
			<></>
		);

	const addGrid =
		componentDefinition?.type && cdDef?.allowedChildrenType?.get('') === -1 ? (
			<>
				<div
					className="_popupMenuItem"
					title="Delete"
					onClick={() => pageOperations.addGrid(menuDetails.componentKey)}
				>
					<IconHelper viewBox="0 0 22 22">
						<path
							d="M8.77778 1H1V8.77778H8.77778V1Z"
							stroke="currentColor"
							strokeWidth="2"
							strokeLinecap="round"
							strokeLinejoin="round"
							fillOpacity="0"
						/>
						<path
							d="M21.0004 1H13.2227V8.77778H21.0004V1Z"
							stroke="currentColor"
							strokeOpacity="0.2"
							strokeWidth="2"
							strokeLinecap="round"
							strokeLinejoin="round"
							fillOpacity="0"
						/>
						<path
							d="M21.0004 13.2222H13.2227V20.9999H21.0004V13.2222Z"
							stroke="currentColor"
							strokeWidth="2"
							strokeLinecap="round"
							strokeLinejoin="round"
							fillOpacity="0"
						/>
						<path
							d="M8.77778 13.2222H1V20.9999H8.77778V13.2222Z"
							stroke="currentColor"
							strokeWidth="2"
							strokeLinecap="round"
							strokeLinejoin="round"
							fillOpacity="0"
						/>
					</IconHelper>
					Add a Grid
				</div>
				<div className="_popupMenuSeperator" />
			</>
		) : (
			<></>
		);
	return (
		<Portal>
			<div
				className={`_popupMenuBackground ${theme}`}
				onClick={onCloseContextmenu}
				onContextMenu={e => {
					e.preventDefault();
				}}
			>
				<div className="_popupMenuContainer _plain" style={{ left, top, right, bottom }}>
					<div className="_contextMenu">
						{addGrid}
						{!ifRoot && (
							<div
								className="_popupMenuItem"
								title="Wrap a grid"
								onClick={() => pageOperations.wrapGrid(menuDetails.componentKey)}
							>
								<IconHelper viewBox="0 0 17 16">
									<path
										d="M2.54149 5.20851V5.45851H2.79149H5.20851H5.45851V5.20851V2.79149V2.54149H5.20851H2.79149H2.54149V2.79149V5.20851ZM6.60426 7.75H1.39574C0.762965 7.75 0.25 7.23703 0.25 6.60426V1.39574C0.25 0.762965 0.762965 0.25 1.39574 0.25H6.60426C7.23703 0.25 7.75 0.762965 7.75 1.39574V6.60426C7.75 7.23703 7.23703 7.75 6.60426 7.75Z"
										fill="currentColor"
										stroke="white"
										strokeWidth="0.5"
									/>
									<path
										d="M11.5416 5.20851V5.45851H11.7916H14.2084H14.4584V5.20851V2.79149V2.54149H14.2084H11.7916H11.5416V2.79149V5.20851ZM15.6042 7.75H10.3958C9.76298 7.75 9.25 7.23702 9.25 6.60426V1.39574C9.25 0.762977 9.76298 0.25 10.3958 0.25H15.6042C16.237 0.25 16.75 0.762977 16.75 1.39574V6.60426C16.75 7.23702 16.237 7.75 15.6042 7.75Z"
										fill="currentColor"
										stroke="white"
										strokeWidth="0.5"
									/>
									<path
										d="M6.25 13.1398H1.75C1.55108 13.1398 1.36032 13.215 1.21967 13.3489C1.07902 13.4828 1 13.6644 1 13.8538C1 14.0431 1.07902 14.2248 1.21967 14.3586C1.36032 14.4925 1.55108 14.5678 1.75 14.5678H6.25C6.44892 14.5678 6.63968 14.4925 6.78033 14.3586C6.92098 14.2248 7 14.0431 7 13.8538C7 13.6644 6.92098 13.4828 6.78033 13.3489C6.63968 13.215 6.44892 13.1398 6.25 13.1398ZM13.375 9.56982H1.75C1.55108 9.56982 1.36032 9.64508 1.21967 9.77895C1.07902 9.91282 1 10.0945 1 10.2838C1 10.4732 1.07902 10.6548 1.21967 10.7887C1.36032 10.9225 1.55108 10.9978 1.75 10.9978H13.375C13.6734 10.9978 13.9595 11.1106 14.1705 11.3115C14.3815 11.5123 14.5 11.7848 14.5 12.0688C14.5 12.3528 14.3815 12.6253 14.1705 12.8261C13.9595 13.027 13.6734 13.1398 13.375 13.1398H11.0575L11.2825 12.9327C11.4237 12.7983 11.5031 12.6159 11.5031 12.4258C11.5031 12.2356 11.4237 12.0533 11.2825 11.9189C11.1413 11.7844 10.9497 11.7089 10.75 11.7089C10.5503 11.7089 10.3587 11.7844 10.2175 11.9189L8.7175 13.3468C8.64925 13.4147 8.5957 13.4948 8.56 13.5824C8.485 13.7563 8.485 13.9512 8.56 14.1251C8.5957 14.2128 8.64925 14.2928 8.7175 14.3607L10.2175 15.7887C10.2872 15.8556 10.3702 15.9087 10.4615 15.945C10.553 15.9812 10.651 15.9999 10.75 15.9999C10.849 15.9999 10.947 15.9812 11.0385 15.945C11.1298 15.9087 11.2128 15.8556 11.2825 15.7887C11.3528 15.7223 11.4086 15.6433 11.4467 15.5563C11.4848 15.4693 11.5044 15.376 11.5044 15.2817C11.5044 15.1875 11.4848 15.0942 11.4467 15.0071C11.4086 14.9202 11.3528 14.8412 11.2825 14.7748L11.0575 14.5678H13.375C14.0712 14.5678 14.7389 14.3045 15.2312 13.8358C15.7235 13.3672 16 12.7316 16 12.0688C16 11.406 15.7235 10.7704 15.2312 10.3017C14.7389 9.83307 14.0712 9.56982 13.375 9.56982Z"
										fill="currentColor"
									/>
								</IconHelper>
								Wrap a Grid
							</div>
						)}
						{showInDesignModeToggle}
						<div className="_popupMenuSeperator" />
						<div
							className="_popupMenuItem"
							title="Delete"
							onClick={() =>
								pageOperations.deleteComponent(menuDetails.componentKey, false)
							}
						>
							<IconHelper viewBox="0 0 15 16">
								<path
									d="M5.7087 1.6125L5.07254 2.5H9.92745L9.29129 1.6125C9.24107 1.54375 9.15737 1.5 9.06696 1.5H5.92969C5.83929 1.5 5.75558 1.54062 5.70536 1.6125H5.7087ZM10.6306 0.78125L11.8594 2.5H12.3214H13.9286H14.1964C14.6417 2.5 15 2.83437 15 3.25C15 3.66563 14.6417 4 14.1964 4H13.9286V13.5C13.9286 14.8813 12.7299 16 11.25 16H3.75C2.27009 16 1.07143 14.8813 1.07143 13.5V4H0.803571C0.358259 4 0 3.66563 0 3.25C0 2.83437 0.358259 2.5 0.803571 2.5H1.07143H2.67857H3.14062L4.36942 0.778125C4.71763 0.29375 5.30357 0 5.92969 0H9.06696C9.69308 0 10.279 0.29375 10.6272 0.778125L10.6306 0.78125ZM2.67857 4V13.5C2.67857 14.0531 3.15737 14.5 3.75 14.5H11.25C11.8426 14.5 12.3214 14.0531 12.3214 13.5V4H2.67857ZM5.35714 6V12.5C5.35714 12.775 5.11607 13 4.82143 13C4.52679 13 4.28571 12.775 4.28571 12.5V6C4.28571 5.725 4.52679 5.5 4.82143 5.5C5.11607 5.5 5.35714 5.725 5.35714 6ZM8.03571 6V12.5C8.03571 12.775 7.79464 13 7.5 13C7.20536 13 6.96429 12.775 6.96429 12.5V6C6.96429 5.725 7.20536 5.5 7.5 5.5C7.79464 5.5 8.03571 5.725 8.03571 6ZM10.7143 6V12.5C10.7143 12.775 10.4732 13 10.1786 13C9.88393 13 9.64286 12.775 9.64286 12.5V6C9.64286 5.725 9.88393 5.5 10.1786 5.5C10.4732 5.5 10.7143 5.725 10.7143 6Z"
									fill="currentColor"
								/>
							</IconHelper>
							Delete
						</div>
						<div
							className="_popupMenuItem"
							title="Delete with events"
							onClick={() =>
								pageOperations.deleteComponent(menuDetails.componentKey, true)
							}
						>
							<IconHelper viewBox="0 0 15 16">
								<path
									d="M5.7087 1.6125L5.07254 2.5H9.92745L9.29129 1.6125C9.24107 1.54375 9.15737 1.5 9.06696 1.5H5.92969C5.83929 1.5 5.75558 1.54062 5.70536 1.6125H5.7087ZM10.6306 0.78125L11.8594 2.5H12.3214H13.9286H14.1964C14.6417 2.5 15 2.83437 15 3.25C15 3.66563 14.6417 4 14.1964 4H13.9286V13.5C13.9286 14.8813 12.7299 16 11.25 16H3.75C2.27009 16 1.07143 14.8813 1.07143 13.5V4H0.803571C0.358259 4 0 3.66563 0 3.25C0 2.83437 0.358259 2.5 0.803571 2.5H1.07143H2.67857H3.14062L4.36942 0.778125C4.71763 0.29375 5.30357 0 5.92969 0H9.06696C9.69308 0 10.279 0.29375 10.6272 0.778125L10.6306 0.78125ZM2.67857 4V13.5C2.67857 14.0531 3.15737 14.5 3.75 14.5H11.25C11.8426 14.5 12.3214 14.0531 12.3214 13.5V4H2.67857ZM5.35714 6V12.5C5.35714 12.775 5.11607 13 4.82143 13C4.52679 13 4.28571 12.775 4.28571 12.5V6C4.28571 5.725 4.52679 5.5 4.82143 5.5C5.11607 5.5 5.35714 5.725 5.35714 6ZM8.03571 6V12.5C8.03571 12.775 7.79464 13 7.5 13C7.20536 13 6.96429 12.775 6.96429 12.5V6C6.96429 5.725 7.20536 5.5 7.5 5.5C7.79464 5.5 8.03571 5.725 8.03571 6ZM10.7143 6V12.5C10.7143 12.775 10.4732 13 10.1786 13C9.88393 13 9.64286 12.775 9.64286 12.5V6C9.64286 5.725 9.88393 5.5 10.1786 5.5C10.4732 5.5 10.7143 5.725 10.7143 6Z"
									fill="currentColor"
								/>
							</IconHelper>
							Delete with Events
						</div>
						{deleteForContainer}
						<div className="_popupMenuSeperator" />
						<div
							className="_popupMenuItem"
							title="Copy"
							onClick={() => pageOperations.copy(menuDetails.componentKey, true)}
						>
							<IconHelper viewBox="0 0 17 17">
								<path
									d="M9.23751 7.0938C9.23751 7.16514 9.20925 7.23345 9.15905 7.28372C9.10836 7.33432 9.04 7.3626 8.96887 7.3626H4.2813C4.13284 7.3626 4.0125 7.24219 4.0125 7.0938C4.0125 6.94541 4.13284 6.825 4.2813 6.825H8.96887C9.04 6.825 9.10836 6.85328 9.15905 6.90388C9.20925 6.95415 9.23751 7.02246 9.23751 7.0938ZM4.28154 8.69988H8.96872C9.11724 8.69988 9.23776 8.82035 9.23776 8.96868C9.23776 9.11712 9.11737 9.23748 8.96912 9.23748H4.28154C4.13308 9.23748 4.01274 9.11707 4.01274 8.96868C4.01274 8.82017 4.13304 8.69988 4.28154 8.69988ZM4.28154 10.5751H8.96872C9.11719 10.5751 9.23776 10.6957 9.23776 10.8439C9.23776 10.9924 9.11742 11.1127 8.96912 11.1127H4.28154C4.13304 11.1127 4.01274 10.9924 4.01274 10.8439C4.01274 10.6955 4.13308 10.5751 4.28154 10.5751ZM4.2813 12.45H8.96887C9.11713 12.45 9.23751 12.5703 9.23751 12.7188C9.23751 12.8672 9.11713 12.9876 8.96887 12.9876H4.2813C4.13284 12.9876 4.0125 12.8672 4.0125 12.7188C4.0125 12.5704 4.13284 12.45 4.2813 12.45Z"
									fill="currentColor"
									stroke="currentColor"
									strokeWidth="0.4"
								/>
								<path
									d="M16 2.87504V11.3125C16 11.8097 15.8024 12.2866 15.4508 12.6384C15.0991 12.9899 14.6222 13.1875 14.125 13.1875H12.2499V14.125C12.2499 14.6222 12.0525 15.0991 11.7008 15.4508C11.3492 15.8024 10.8723 16 10.3751 16H2.87503C2.37783 16 1.90087 15.8024 1.54915 15.4508C1.1976 15.0991 1 14.6222 1 14.125V5.68752C1 5.19031 1.1976 4.71336 1.54915 4.36164C1.90087 4.01008 2.37783 3.81248 2.87503 3.81248H4.75006V2.87504C4.75006 2.37783 4.9475 1.90088 5.29921 1.54916C5.65077 1.1976 6.12773 1 6.62493 1H14.125C14.6222 1 15.0991 1.1976 15.4508 1.54916C15.8024 1.90087 16 2.37783 16 2.87504ZM11.3124 5.68752C11.3121 5.43892 11.2132 5.20068 11.0375 5.0249C10.8618 4.84912 10.6234 4.75024 10.375 4.75009H2.87496C2.62636 4.75024 2.38812 4.84912 2.21234 5.0249C2.03656 5.20068 1.93769 5.43894 1.93753 5.68752V14.125C1.93769 14.3736 2.03656 14.6118 2.21234 14.7876C2.38812 14.9634 2.62638 15.0622 2.87496 15.0624H10.375C10.6234 15.0622 10.8618 14.9634 11.0375 14.7876C11.2132 14.6118 11.3121 14.3735 11.3124 14.125V5.68752ZM15.0623 2.87504C15.0622 2.62644 14.9633 2.3882 14.7875 2.21242C14.6117 2.03664 14.3735 1.93776 14.1249 1.93761H6.62486C6.37641 1.93776 6.13802 2.03664 5.9624 2.21242C5.78662 2.3882 5.68775 2.62646 5.68743 2.87504V3.81248H10.375C10.8722 3.81248 11.3492 4.01008 11.7007 4.36164C12.0524 4.71335 12.2499 5.19031 12.2499 5.68752V12.2498H14.1249C14.3735 12.2497 14.6117 12.1508 14.7875 11.975C14.9633 11.7992 15.0622 11.561 15.0623 11.3124L15.0623 2.87504Z"
									fill="currentColor"
									stroke="currentColor"
									strokeWidth="0.4"
								/>
							</IconHelper>
							Copy
						</div>
						<div
							className="_popupMenuItem"
							title="copyWithOutEvents"
							onClick={() => pageOperations.copy(menuDetails.componentKey, false)}
						>
							<IconHelper viewBox="0 0 17 17">
								<path
									d="M9.23751 7.0938C9.23751 7.16514 9.20925 7.23345 9.15905 7.28372C9.10836 7.33432 9.04 7.3626 8.96887 7.3626H4.2813C4.13284 7.3626 4.0125 7.24219 4.0125 7.0938C4.0125 6.94541 4.13284 6.825 4.2813 6.825H8.96887C9.04 6.825 9.10836 6.85328 9.15905 6.90388C9.20925 6.95415 9.23751 7.02246 9.23751 7.0938ZM4.28154 8.69988H8.96872C9.11724 8.69988 9.23776 8.82035 9.23776 8.96868C9.23776 9.11712 9.11737 9.23748 8.96912 9.23748H4.28154C4.13308 9.23748 4.01274 9.11707 4.01274 8.96868C4.01274 8.82017 4.13304 8.69988 4.28154 8.69988ZM4.28154 10.5751H8.96872C9.11719 10.5751 9.23776 10.6957 9.23776 10.8439C9.23776 10.9924 9.11742 11.1127 8.96912 11.1127H4.28154C4.13304 11.1127 4.01274 10.9924 4.01274 10.8439C4.01274 10.6955 4.13308 10.5751 4.28154 10.5751ZM4.2813 12.45H8.96887C9.11713 12.45 9.23751 12.5703 9.23751 12.7188C9.23751 12.8672 9.11713 12.9876 8.96887 12.9876H4.2813C4.13284 12.9876 4.0125 12.8672 4.0125 12.7188C4.0125 12.5704 4.13284 12.45 4.2813 12.45Z"
									fill="currentColor"
									stroke="currentColor"
									strokeWidth="0.4"
								/>
								<path
									d="M16 2.87504V11.3125C16 11.8097 15.8024 12.2866 15.4508 12.6384C15.0991 12.9899 14.6222 13.1875 14.125 13.1875H12.2499V14.125C12.2499 14.6222 12.0525 15.0991 11.7008 15.4508C11.3492 15.8024 10.8723 16 10.3751 16H2.87503C2.37783 16 1.90087 15.8024 1.54915 15.4508C1.1976 15.0991 1 14.6222 1 14.125V5.68752C1 5.19031 1.1976 4.71336 1.54915 4.36164C1.90087 4.01008 2.37783 3.81248 2.87503 3.81248H4.75006V2.87504C4.75006 2.37783 4.9475 1.90088 5.29921 1.54916C5.65077 1.1976 6.12773 1 6.62493 1H14.125C14.6222 1 15.0991 1.1976 15.4508 1.54916C15.8024 1.90087 16 2.37783 16 2.87504ZM11.3124 5.68752C11.3121 5.43892 11.2132 5.20068 11.0375 5.0249C10.8618 4.84912 10.6234 4.75024 10.375 4.75009H2.87496C2.62636 4.75024 2.38812 4.84912 2.21234 5.0249C2.03656 5.20068 1.93769 5.43894 1.93753 5.68752V14.125C1.93769 14.3736 2.03656 14.6118 2.21234 14.7876C2.38812 14.9634 2.62638 15.0622 2.87496 15.0624H10.375C10.6234 15.0622 10.8618 14.9634 11.0375 14.7876C11.2132 14.6118 11.3121 14.3735 11.3124 14.125V5.68752ZM15.0623 2.87504C15.0622 2.62644 14.9633 2.3882 14.7875 2.21242C14.6117 2.03664 14.3735 1.93776 14.1249 1.93761H6.62486C6.37641 1.93776 6.13802 2.03664 5.9624 2.21242C5.78662 2.3882 5.68775 2.62646 5.68743 2.87504V3.81248H10.375C10.8722 3.81248 11.3492 4.01008 11.7007 4.36164C12.0524 4.71335 12.2499 5.19031 12.2499 5.68752V12.2498H14.1249C14.3735 12.2497 14.6117 12.1508 14.7875 11.975C14.9633 11.7992 15.0622 11.561 15.0623 11.3124L15.0623 2.87504Z"
									fill="currentColor"
									stroke="currentColor"
									strokeWidth="0.4"
								/>
							</IconHelper>
							Copy without Events
						</div>
						<div
							className="_popupMenuItem"
							title="Cut"
							onClick={() => pageOperations.cut(menuDetails.componentKey, true)}
						>
							<IconHelper viewBox="0 0 16 16">
								<path
									d="M8 6.5L7.00763 5.16992C7.1436 4.82539 7.21575 4.45352 7.21575 4.0625C7.21575 2.36992 5.82553 1 4.10787 1C2.39022 1 1 2.36992 1 4.0625C1 5.75508 2.39022 7.125 4.10787 7.125C4.50468 7.125 4.88207 7.05117 5.2317 6.91992L6.32778 8L5.2317 9.08008C4.88207 8.94609 4.50468 8.875 4.10787 8.875C2.39022 8.875 1 10.2449 1 11.9375C1 13.6301 2.39022 15 4.10787 15C5.82553 15 7.21575 13.6301 7.21575 11.9375C7.21575 11.5465 7.14083 11.1746 7.00763 10.8301L14.8522 3.1C15.0493 2.90586 15.0493 2.59414 14.8522 2.4C14.0669 1.62617 13.2853 1.72617 12.5 2.5L8 6.5ZM8.73084 10.368L12.0108 13.6C12.796 14.3738 14.0669 14.3738 14.8522 13.6C15.0493 13.4059 15.0493 13.0941 14.8522 12.9L10.5068 8.61797L8.73084 10.368ZM2.77593 4.0625C2.77593 3.89014 2.81038 3.71947 2.87732 3.56023C2.94425 3.40099 3.04236 3.2563 3.16605 3.13442C3.28973 3.01255 3.43656 2.91587 3.59816 2.84991C3.75976 2.78395 3.93296 2.75 4.10787 2.75C4.28279 2.75 4.45599 2.78395 4.61759 2.84991C4.77919 2.91587 4.92602 3.01255 5.0497 3.13442C5.17338 3.2563 5.27149 3.40099 5.33843 3.56023C5.40537 3.71947 5.43982 3.89014 5.43982 4.0625C5.43982 4.23486 5.40537 4.40553 5.33843 4.56477C5.27149 4.72401 5.17338 4.8687 5.0497 4.99058C4.92602 5.11245 4.77919 5.20913 4.61759 5.27509C4.45599 5.34105 4.28279 5.375 4.10787 5.375C3.93296 5.375 3.75976 5.34105 3.59816 5.27509C3.43656 5.20913 3.28973 5.11245 3.16605 4.99058C3.04236 4.8687 2.94425 4.72401 2.87732 4.56477C2.81038 4.40553 2.77593 4.23486 2.77593 4.0625ZM4.10787 10.625C4.28279 10.625 4.45599 10.6589 4.61759 10.7249C4.77919 10.7909 4.92602 10.8875 5.0497 11.0094C5.17338 11.1313 5.27149 11.276 5.33843 11.4352C5.40537 11.5945 5.43982 11.7651 5.43982 11.9375C5.43982 12.1099 5.40537 12.2805 5.33843 12.4398C5.27149 12.599 5.17338 12.7437 5.0497 12.8656C4.92602 12.9875 4.77919 13.0841 4.61759 13.1501C4.45599 13.2161 4.28279 13.25 4.10787 13.25C3.93296 13.25 3.75976 13.2161 3.59816 13.1501C3.43656 13.0841 3.28973 12.9875 3.16605 12.8656C3.04236 12.7437 2.94425 12.599 2.87732 12.4398C2.81038 12.2805 2.77593 12.1099 2.77593 11.9375C2.77593 11.7651 2.81038 11.5945 2.87732 11.4352C2.94425 11.276 3.04236 11.1313 3.16605 11.0094C3.28973 10.8875 3.43656 10.7909 3.59816 10.7249C3.75976 10.6589 3.93296 10.625 4.10787 10.625Z"
									fill="currentColor"
									stroke="white"
									strokeWidth="0.4"
								/>
							</IconHelper>
							Cut
						</div>
						<div
							className="_popupMenuItem"
							title="Cut"
							onClick={() => pageOperations.cut(menuDetails.componentKey, false)}
						>
							<IconHelper viewBox="0 0 16 16">
								<path
									d="M8 6.5L7.00763 5.16992C7.1436 4.82539 7.21575 4.45352 7.21575 4.0625C7.21575 2.36992 5.82553 1 4.10787 1C2.39022 1 1 2.36992 1 4.0625C1 5.75508 2.39022 7.125 4.10787 7.125C4.50468 7.125 4.88207 7.05117 5.2317 6.91992L6.32778 8L5.2317 9.08008C4.88207 8.94609 4.50468 8.875 4.10787 8.875C2.39022 8.875 1 10.2449 1 11.9375C1 13.6301 2.39022 15 4.10787 15C5.82553 15 7.21575 13.6301 7.21575 11.9375C7.21575 11.5465 7.14083 11.1746 7.00763 10.8301L14.8522 3.1C15.0493 2.90586 15.0493 2.59414 14.8522 2.4C14.0669 1.62617 13.2853 1.72617 12.5 2.5L8 6.5ZM8.73084 10.368L12.0108 13.6C12.796 14.3738 14.0669 14.3738 14.8522 13.6C15.0493 13.4059 15.0493 13.0941 14.8522 12.9L10.5068 8.61797L8.73084 10.368ZM2.77593 4.0625C2.77593 3.89014 2.81038 3.71947 2.87732 3.56023C2.94425 3.40099 3.04236 3.2563 3.16605 3.13442C3.28973 3.01255 3.43656 2.91587 3.59816 2.84991C3.75976 2.78395 3.93296 2.75 4.10787 2.75C4.28279 2.75 4.45599 2.78395 4.61759 2.84991C4.77919 2.91587 4.92602 3.01255 5.0497 3.13442C5.17338 3.2563 5.27149 3.40099 5.33843 3.56023C5.40537 3.71947 5.43982 3.89014 5.43982 4.0625C5.43982 4.23486 5.40537 4.40553 5.33843 4.56477C5.27149 4.72401 5.17338 4.8687 5.0497 4.99058C4.92602 5.11245 4.77919 5.20913 4.61759 5.27509C4.45599 5.34105 4.28279 5.375 4.10787 5.375C3.93296 5.375 3.75976 5.34105 3.59816 5.27509C3.43656 5.20913 3.28973 5.11245 3.16605 4.99058C3.04236 4.8687 2.94425 4.72401 2.87732 4.56477C2.81038 4.40553 2.77593 4.23486 2.77593 4.0625ZM4.10787 10.625C4.28279 10.625 4.45599 10.6589 4.61759 10.7249C4.77919 10.7909 4.92602 10.8875 5.0497 11.0094C5.17338 11.1313 5.27149 11.276 5.33843 11.4352C5.40537 11.5945 5.43982 11.7651 5.43982 11.9375C5.43982 12.1099 5.40537 12.2805 5.33843 12.4398C5.27149 12.599 5.17338 12.7437 5.0497 12.8656C4.92602 12.9875 4.77919 13.0841 4.61759 13.1501C4.45599 13.2161 4.28279 13.25 4.10787 13.25C3.93296 13.25 3.75976 13.2161 3.59816 13.1501C3.43656 13.0841 3.28973 12.9875 3.16605 12.8656C3.04236 12.7437 2.94425 12.599 2.87732 12.4398C2.81038 12.2805 2.77593 12.1099 2.77593 11.9375C2.77593 11.7651 2.81038 11.5945 2.87732 11.4352C2.94425 11.276 3.04236 11.1313 3.16605 11.0094C3.28973 10.8875 3.43656 10.7909 3.59816 10.7249C3.75976 10.6589 3.93296 10.625 4.10787 10.625Z"
									fill="currentColor"
									stroke="white"
									strokeWidth="0.4"
								/>
							</IconHelper>
							Cut without Events
						</div>
						<div className="_popupMenuSeperator" />
						<div
							className="_popupMenuItem"
							title="Paste"
							onClick={() => pageOperations.paste(menuDetails.componentKey)}
						>
							<IconHelper viewBox="0 0 17 17">
								<path
									d="M0.999999 2.87504V11.3125C0.999999 11.8097 1.1976 12.2866 1.54915 12.6384C1.90087 12.9899 2.37783 13.1875 2.87503 13.1875H4.75006V14.125C4.75006 14.6222 4.9475 15.0991 5.29921 15.4508C5.65077 15.8024 6.12773 16 6.62493 16H14.125C14.6222 16 15.0991 15.8024 15.4508 15.4508C15.8024 15.0991 16 14.6222 16 14.125V5.68752C16 5.19031 15.8024 4.71336 15.4508 4.36164C15.0991 4.01008 14.6222 3.81248 14.125 3.81248H12.2499V2.87504C12.2499 2.37783 12.0525 1.90088 11.7008 1.54916C11.3492 1.1976 10.8723 1 10.3751 1H2.87503C2.37783 1 1.90087 1.1976 1.54915 1.54916C1.1976 1.90087 0.999999 2.37783 0.999999 2.87504ZM5.68757 5.68752C5.68789 5.43892 5.78677 5.20068 5.96254 5.0249C6.13817 4.84912 6.37658 4.75024 6.625 4.75009H14.125C14.3736 4.75024 14.6119 4.84912 14.7877 5.0249C14.9634 5.20068 15.0623 5.43894 15.0625 5.68752V14.125C15.0623 14.3736 14.9634 14.6118 14.7877 14.7876C14.6119 14.9634 14.3736 15.0622 14.125 15.0624H6.625C6.37656 15.0622 6.13816 14.9634 5.96254 14.7876C5.78677 14.6118 5.68789 14.3735 5.68757 14.125V5.68752ZM1.93767 2.87504C1.93783 2.62644 2.03671 2.3882 2.21249 2.21242C2.38826 2.03664 2.62652 1.93776 2.8751 1.93761H10.3751C10.6236 1.93776 10.862 2.03664 11.0376 2.21242C11.2134 2.3882 11.3123 2.62646 11.3126 2.87504V3.81248H6.625C6.12779 3.81248 5.65084 4.01008 5.29928 4.36164C4.94756 4.71335 4.75013 5.19031 4.75013 5.68752V12.2498H2.8751C2.62649 12.2497 2.38826 12.1508 2.21248 11.975C2.0367 11.7992 1.93783 11.561 1.93767 11.3124L1.93767 2.87504Z"
									fill="currentColor"
									stroke="currentColor"
									strokeWidth="0.4"
								/>
							</IconHelper>
							Paste
						</div>
						{formStorageUrl != undefined && componentDefinition?.type == 'Grid' && (
							<div
								className="_popupMenuItem"
								title="Generate a Form"
								onClick={() => setClickedComponent(menuDetails.componentKey)}
							>
								<IconHelper viewBox="0 0 17 17">
									<path
										d="M1.19718 0.5H7.60094V3.45455C7.60094 4.61086 8.54087 5.5508 9.69718 5.5508H12.6517V15.8028C12.6517 16.1868 12.3385 16.5 11.9546 16.5H1.19718C0.813199 16.5 0.5 16.1868 0.5 15.8028V1.19718C0.5 0.813199 0.813199 0.5 1.19718 0.5Z"
										stroke="currentColor"
										fill="none"
									/>
									<path
										d="M9.90007 7.14648L9.73482 7.25915C9.77242 7.3143 9.79982 7.4006 9.79982 7.50005C9.79982 7.5995 9.77242 7.6858 9.73482 7.74095L9.90007 7.85361M9.90007 7.14648L9.73491 7.25929C9.69728 7.20419 9.66615 7.2 9.659 7.2H3.34093C3.33239 7.2 3.30205 7.20495 3.2651 7.25915C3.22885 7.31233 3.2 7.39692 3.2 7.50005C3.2 7.60318 3.22885 7.68777 3.2651 7.74095C3.30205 7.79515 3.33239 7.8001 3.34093 7.8001H9.659C9.66615 7.8001 9.69728 7.79591 9.73491 7.74081L9.90007 7.85361M9.90007 7.14648C9.96398 7.24023 9.99982 7.36746 9.99982 7.50005C9.99982 7.63264 9.96398 7.75987 9.90007 7.85361M9.90007 7.14648V7.85361M3.34111 9.19985H9.65889C9.66744 9.19985 9.69784 9.20483 9.73483 9.25903C9.77111 9.31219 9.8 9.39675 9.8 9.4999C9.8 9.60303 9.77115 9.68763 9.7349 9.74082C9.69795 9.79504 9.66763 9.79995 9.65918 9.79995H3.34111C3.33257 9.79995 3.30223 9.795 3.26528 9.7408C3.22903 9.68762 3.20018 9.60303 3.20018 9.4999C3.20018 9.39667 3.22904 9.3121 3.26527 9.25896C3.30218 9.20482 3.33251 9.19985 3.34111 9.19985ZM3.34111 11.2H9.65889C9.66739 11.2 9.69779 11.205 9.73482 11.2593C9.77112 11.3125 9.8 11.397 9.8 11.5001C9.8 11.6033 9.77114 11.6879 9.73491 11.7411C9.69799 11.7952 9.66769 11.8001 9.65918 11.8001H3.34111C3.33251 11.8001 3.30218 11.7952 3.26527 11.741C3.22904 11.6879 3.20018 11.6033 3.20018 11.5001C3.20018 11.397 3.22903 11.3124 3.26528 11.2592C3.30223 11.205 3.33257 11.2 3.34111 11.2ZM3.34093 13.1999H9.659C9.66745 13.1999 9.69777 13.2048 9.73472 13.259C9.77097 13.3122 9.79982 13.3968 9.79982 13.5C9.79982 13.6031 9.77097 13.6877 9.73472 13.7409C9.69777 13.7951 9.66745 13.8 9.659 13.8H3.34093C3.33239 13.8 3.30205 13.795 3.2651 13.7408C3.22885 13.6877 3.2 13.6031 3.2 13.5C3.2 13.3968 3.22885 13.3122 3.2651 13.2591C3.30205 13.2049 3.33239 13.1999 3.34093 13.1999Z"
										fill="currentColor"
										stroke="currentColor"
										strokeWidth="0.4"
									/>
									<path
										d="M8.90039 3.45492C8.90039 3.895 9.25843 4.25304 9.69851 4.25304H12.5613L8.90039 0.609375V3.45492Z"
										fill="currentColor"
									/>
								</IconHelper>
								Generate a Form
							</div>
						)}
						{componentDefinition.type === 'Grid' && (
							<div
								className="_popupMenuItem"
								title={
									intermediateDefinition
										? 'Edit Form Definition'
										: 'Generate Form from schema'
								}
								onClick={() => setShowSchemaFormEditor(menuDetails.componentKey)}
							>
								<IconHelper viewBox="0 0 17 17">
									<path
										d="M1.19718 0.5H7.60094V3.45455C7.60094 4.61086 8.54087 5.5508 9.69718 5.5508H12.6517V15.8028C12.6517 16.1868 12.3385 16.5 11.9546 16.5H1.19718C0.813199 16.5 0.5 16.1868 0.5 15.8028V1.19718C0.5 0.813199 0.813199 0.5 1.19718 0.5Z"
										stroke="currentColor"
										fill="none"
									/>
									<path
										d="M9.90007 7.14648L9.73482 7.25915C9.77242 7.3143 9.79982 7.4006 9.79982 7.50005C9.79982 7.5995 9.77242 7.6858 9.73482 7.74095L9.90007 7.85361M9.90007 7.14648L9.73491 7.25929C9.69728 7.20419 9.66615 7.2 9.659 7.2H3.34093C3.33239 7.2 3.30205 7.20495 3.2651 7.25915C3.22885 7.31233 3.2 7.39692 3.2 7.50005C3.2 7.60318 3.22885 7.68777 3.2651 7.74095C3.30205 7.79515 3.33239 7.8001 3.34093 7.8001H9.659C9.66615 7.8001 9.69728 7.79591 9.73491 7.74081L9.90007 7.85361M9.90007 7.14648C9.96398 7.24023 9.99982 7.36746 9.99982 7.50005C9.99982 7.63264 9.96398 7.75987 9.90007 7.85361M9.90007 7.14648V7.85361M3.34111 9.19985H9.65889C9.66744 9.19985 9.69784 9.20483 9.73483 9.25903C9.77111 9.31219 9.8 9.39675 9.8 9.4999C9.8 9.60303 9.77115 9.68763 9.7349 9.74082C9.69795 9.79504 9.66763 9.79995 9.65918 9.79995H3.34111C3.33257 9.79995 3.30223 9.795 3.26528 9.7408C3.22903 9.68762 3.20018 9.60303 3.20018 9.4999C3.20018 9.39667 3.22904 9.3121 3.26527 9.25896C3.30218 9.20482 3.33251 9.19985 3.34111 9.19985ZM3.34111 11.2H9.65889C9.66739 11.2 9.69779 11.205 9.73482 11.2593C9.77112 11.3125 9.8 11.397 9.8 11.5001C9.8 11.6033 9.77114 11.6879 9.73491 11.7411C9.69799 11.7952 9.66769 11.8001 9.65918 11.8001H3.34111C3.33251 11.8001 3.30218 11.7952 3.26527 11.741C3.22904 11.6879 3.20018 11.6033 3.20018 11.5001C3.20018 11.397 3.22903 11.3124 3.26528 11.2592C3.30223 11.205 3.33257 11.2 3.34111 11.2ZM3.34093 13.1999H9.659C9.66745 13.1999 9.69777 13.2048 9.73472 13.259C9.77097 13.3122 9.79982 13.3968 9.79982 13.5C9.79982 13.6031 9.77097 13.6877 9.73472 13.7409C9.69777 13.7951 9.66745 13.8 9.659 13.8H3.34093C3.33239 13.8 3.30205 13.795 3.2651 13.7408C3.22885 13.6877 3.2 13.6031 3.2 13.5C3.2 13.3968 3.22885 13.3122 3.2651 13.2591C3.30205 13.2049 3.33239 13.1999 3.34093 13.1999Z"
										fill="currentColor"
										stroke="currentColor"
										strokeWidth="0.4"
									/>
									<path
										d="M8.90039 3.45492C8.90039 3.895 9.25843 4.25304 9.69851 4.25304H12.5613L8.90039 0.609375V3.45492Z"
										fill="currentColor"
									/>
								</IconHelper>
								{intermediateDefinition
									? 'Edit Form Definition'
									: 'Generate Form from schema'}
							</div>
						)}
					</div>
				</div>
			</div>
		</Portal>
	);
}
